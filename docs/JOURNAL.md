# ğŸ¦€ï¸Rust ç§»åŠ¨ç«¯å¼€å‘ä½“éªŒ

åœ¨è¿‡å»çš„å‡ å‘¨é‡Œï¼Œæˆ‘æ ¹æ® Xlog å’Œ Loagan çš„è®¾è®¡æ€è·¯ï¼Œä½¿ç”¨ Rust å†™äº†ä¸€ä¸ªç§»åŠ¨ç«¯çš„è·¨å¹³å°æ—¥å¿—åº“[EZLog](https://github.com/s1rius/ezlog)ã€‚</p>
åœ¨æˆ‘å®ç°è¿™ä¸ªåº“çš„è¿‡ç¨‹ä¸­ï¼ŒæŸ¥é˜…äº†å¤§é‡çš„é—®ç­”å’Œåšå®¢ã€‚å› ä¸ºè¿™äº›å¼€å‘è€…çš„åˆ†äº«ï¼ŒèŠ‚çœäº†æˆ‘å¤§é‡çš„æ—¶é—´ã€‚æ‰€ä»¥æˆ‘æŠŠæˆ‘çš„ç»å†ä¹Ÿåˆ†äº«å‡ºæ¥ã€‚</p>

å¦‚æœä»¥ä¸‹ä»»ä½•ä¸€ä¸ªç‚¹ä½ æ„Ÿå…´è¶£ï¼Œä¸è¦åˆ’èµ°ã€‚

- å½“ä¸‹(2022)Rust åœ¨ç§»åŠ¨ç«¯çš„å¼€å‘ä½“éªŒå¦‚ä½•
- æ²¡æœ‰ Java/Kotlin ä»£ç ï¼Œä¸ä½¿ç”¨ AndroidStudio å’Œ Gradle, ç§’çº§ç¼–è¯‘å¹¶æ‰“åŒ… Apk è¿è¡Œ
- Rust ç¼–è¯‘é™æ€åº“æ‰“åŒ…åˆ° XCFramework, å‘å¸ƒ Cocoapods

### èµ·å› 

22 å¹´åˆï¼Œæˆ‘æœ‰ä¸€ä¸ªæ¸¸æˆéœ€æ±‚ï¼Œè¦åœ¨ android ä¸Šå®ç°åŒ€é€Ÿçš„è´å¡å°”æ›²çº¿è·¯å¾„ç§»åŠ¨ã€‚ä¾èµ– [kurbo](https://github.com/linebender/kurbo)å†™äº†ä¸€ä¸ªç”Ÿæˆ[è´å¡å°”æ›²çº¿ LUT](https://youtu.be/aVwxzDHniEw?t=1058) çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä½“éªŒå¾ˆå¥½ã€‚äºæ˜¯æƒ³å°è¯•ä¸€ä¸‹ï¼Œå‘æŒ¥ Rust çš„ä¼˜åŠ¿ï¼Œåœ¨ç§»åŠ¨ç«¯å†™ä¸€ä¸ªå¯¹æ€§èƒ½æœ‰è¦æ±‚çš„å¼€æºåº“ï¼Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯æ—¥å¿—ã€‚


<img width="200" src="./taste.gif" />

### å¯è¡Œæ€§è°ƒæŸ¥

#### å¤§å‹å…¬å¸åœ¨ç§»åŠ¨ç«¯ä½¿ç”¨ Rust

- Google åœ¨ 2021 å¹´å°† Rust å¼•å…¥ Android [Rust in the Android platform](https://security.googleblog.com/2021/04/rust-in-android-platform.html)
- Mozilla ä½¿ç”¨ Rust ç¼–å†™è·¨å¹³å°åº”ç”¨æœåŠ¡ç»„ä»¶[Firefox Application Services](https://github.com/mozilla/application-services)
- [é£ä¹¦å®¢æˆ·ç«¯é UI éƒ¨åˆ†ä½¿ç”¨ Rust è·¨å¹³å°å®ç°](https://www.infoq.cn/article/oh79weak7z3s2xavo*bv)

#### ä¸ªäººå¼€å‘è€…åœ¨ç§»åŠ¨ç«¯çš„å°è¯• Rust çš„æ¡ˆä¾‹

- [Rust & cross-platform mobile development](https://medium.com/swlh/rust-cross-platform-mobile-development-9117a67ac9b7)
- [RustDesk è¿œç¨‹æ¡Œé¢åº”ç”¨](https://github.com/rustdesk/rustdesk)
- [æ·±åº¦æ¢ç´¢ï¼šå‰ç«¯ä¸­çš„åç«¯](https://zhuanlan.zhihu.com/p/347842418)
- [Publish game on Android with Macroquad](https://macroquad.rs/tutorials/android/)
- [Rust on iOS and Mac Catalyst: A Simple, Updated Guide](https://nadim.computer/posts/2022-02-11-maccatalyst.html)

æ›´å¤šçš„æ¡ˆä¾‹æ”¶å½•ï¼Œå¯ä»¥å‚çœ‹è¿™ç¯‡[Rust ç§»åŠ¨å¼€å‘ä¸è·¨å¹³å°æ¨¡å¼æ¢ç©¶](https://zhuanlan.zhihu.com/p/484269271)ã€‚
ä»ä»¥ä¸Šçš„ä¾‹å­æ¥çœ‹ï¼Œå¤§æ¦‚ç‡æ˜¯å¯è¡Œçš„ï¼Œè¿˜è¦å¯¹å…·ä½“çš„éœ€æ±‚è¿›è¡ŒéªŒè¯ã€‚

### é¡¹ç›®ç®€è¿°

#### ä¸»è¦åŠŸèƒ½

- ä½¿ç”¨ mmap åšæ–‡ä»¶æ˜ å°„
- è®¤è¯åŠ å¯†
- zlib å‹ç¼©
- æ—¥å¿—å›æ
- æ—¥å¿—æ¸…ç†
- å‘½ä»¤è¡Œè§£æå·¥å…·

#### å¯è¡Œæ€§éªŒè¯

å…ˆæŸ¥æ‰¾ä¸»è¦åŠŸèƒ½æ˜¯å¦æœ‰å¯¹åº”çš„ Rust å¼€æºå®ç°ã€‚

- [memmap2](https://github.com/RazrFalcon/memmap2-rs)
- [aead](https://github.com/RustCrypto/AEADs)
- [flate2](https://github.com/rust-lang/flate2-rs)

å¼€æºç¤¾åŒºæ—©å·²å®ç°å¥½äº†ï¼šï¼‰</br>
å¤åˆ¶å¼€æºåº“ä¸­çš„ç¤ºä¾‹ï¼Œå€ŸåŠ©[android-ndk-rs](https://github.com/rust-windowing/android-ndk-rs)ã€‚åœ¨ android çœŸæœºè¿è¡Œï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼Œç¬¦åˆé¢„æœŸã€‚</br>
é¡¹ç›®ä¸­ä½¿ç”¨`android ndk rs`çš„ä¾‹å­ï¼Œå¯ä»¥æŸ¥çœ‹`examples/android_preview`

<details>
<summary><b>ç¼–è¯‘æˆAPKå¹¶å®‰è£…è¿è¡Œä¸åˆ°5ç§’</b></summary>
</p>

```shell
cargo apk run -p ezlog_android_preview
   Compiling ezlog v0.1.2 (ezlog/ezlog-core)
   Compiling ezlog_android_preview v0.1.0 (ezlog/examples/android_preview)
    Finished dev [unoptimized + debuginfo] target(s) in 2.39s
 'lib/arm64-v8a/libezlog_android_preview.so'...
Verifying alignment of ezlog/target/debug/apk/ezlog_android_preview.apk (4)...
      49 AndroidManifest.xml (OK - compressed)
    1020 lib/arm64-v8a/libezlog_android_preview.so (OK)
Verification succesful
Performing Incremental Install
Serving...
All files should be loaded. Notifying the device.
Success
Install command complete in 949 ms
Starting: Intent { act=android.intent.action.MAIN cmp=rust.ezlog_android_preview/android.app.NativeActivity }
```

</details>

<img width = "200" src="./boom.gif"/>

#### é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ android
â”‚Â Â  â”œâ”€â”€ app # android ç¤ºä¾‹å·¥ç¨‹
â”‚Â Â  â””â”€â”€ lib-ezlog # EZLog android åº“
â”œâ”€â”€ examples # rust ç¤ºä¾‹
â”œâ”€â”€ ezlog-cli # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ ezlog-core # æ ¸å¿ƒåº“
â”œâ”€â”€ ios
â”‚Â Â  â”œâ”€â”€ EZLog # EZLog iOS åº“
â”‚Â Â  â”œâ”€â”€ demo # iOS ç¤ºä¾‹å·¥ç¨‹
â”‚Â Â  â””â”€â”€ framework # EZLog XCFramework
```

### å¼€å‘ä¸­ç¢°åˆ°çš„é—®é¢˜åŠè§£å†³

#### iOS

iOS ç«¯çš„å¼€å‘æµç¨‹ä¸º

1. Rust ç¼–ç 
2. é€šè¿‡ [cbindgen](https://github.com/eqrion/cbindgen) ç”Ÿæˆå¤´æ–‡ä»¶
3. ç¼–è¯‘å¤šå¹³å°é™æ€åº“
4. æŠŠé™æ€åº“å’Œå¤´æ–‡ä»¶æ‰“åŒ…æˆ XCFrameworkï¼Œå¹¶ä¾èµ–
5. å®ç° Swift ç»‘å®š
6. æµ‹è¯•ï¼Œå‘å¸ƒ

åœ¨å¯¹æ¯”äº†å¤šç§ä¾èµ–é™æ€åº“çš„æ–¹å¼ä¹‹åï¼Œå‘ç°[XCFramework](https://help.apple.com/xcode/mac/11.4/#/dev6f6ac218b)å¯¹å¤šå¹³å°çš„æ”¯æŒï¼Œæ›´é€‚åˆè¿™ä¸ªé¡¹ç›®ã€‚æ›´å¤š XCFramework çš„ç›¸å…³èµ„æ–™å¯ä»¥çœ‹è¿™å‡ ç¯‡æ–‡ç« [distributing universal ios frameworks as xcframeworks using cocoapods](https://anuragajwani.medium.com/distributing-universal-ios-frameworks-as-xcframeworks-using-cocoapods-699c70a5c961),
[Static libraries into XCFramework](https://developer.apple.com/forums/thread/678075?answerId=671170022#671170022),[From Rust To Swift](https://betterprogramming.pub/from-rust-to-swift-df9bde59b7cd)ã€‚åœ¨é¡¹ç›®ä¸­çš„æ„å»ºä½¿ç”¨ï¼Œå¯ä»¥å‚çœ‹`ios/b_ios.sh`è„šæœ¬ã€‚</p>

Swift ä¸ C çš„äº’ç›¸è°ƒç”¨ï¼Œå¾ˆå¤šæ¦‚å¿µéœ€è¦äº†è§£ã€‚åœ¨è¢«`Unmanaged`, `@escaping`,`@convention`,`UnsafePointer`,`UnsafeBufferPointer`,
`UnsafeMutableRawPointer` æŠ˜ç£¨è®¸ä¹…ä¹‹åï¼Œç»ˆäºå¯ä»¥åœ¨ Swift ä¸­æ‹¿åˆ° Rust çš„å›è°ƒäº†ã€‚</p>

Cocoapods æ”¯æŒ XCFrameworkï¼Œå°è¯•äº† SPMï¼Œæ‰¾ä¸åˆ°ç¬¦å·çš„é—®é¢˜æ²¡æœ‰è§£å†³ã€‚æš‚æ—¶æ”¾ä¸€æ”¾ã€‚åœ¨èŠ±è´¹äº†ä»¥å¤©è®¡çš„æ—¶é—´æˆæœ¬ä¹‹åï¼Œç»ˆäºåœ¨ Cocoapods æˆåŠŸå‘å¸ƒã€‚</p>

å¯¹æ¯”ä¸€ä¸‹ä¸‰ä¸ªåŒ…ç®¡ç†å·¥å…·çš„ä»æ³¨å†Œåˆ°å‘å¸ƒçš„æ—¶é—´æˆæœ¬ï¼Œä»ç®€å•åˆ°ç¹ççš„æ’åºæ˜¯ Cargo < Cocoapods < Mavenã€‚</p>

éšç€è‹¹æœåœ¨ XCode14 ä¸­åºŸå¼ƒäº† bitcodeï¼ŒRust åœ¨ iOS/MacOS ä¸­æœ€å¤§çš„[ç—›ç‚¹](https://github.com/rust-lang/rust/issues/35968)ä¹Ÿå°±æ¶ˆå¤±äº†ã€‚

#### android FFI

android ä¸Š Rust ä¸ JNI çš„äº’è°ƒå’Œ C/C++çš„åŒºåˆ«ä¸å¤§ã€‚åŒæ ·è¦è€ƒè™‘å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå…¨å±€çš„ JavaVM å¼•ç”¨ï¼Œç±»åŠ è½½åˆ° JVMï¼Œnative çº¿ç¨‹åœ¨ JVM çš„ attach å’Œ detachï¼Œè¯¦ç»†çš„ç¤ºä¾‹ä»£ç å¯ä»¥æŸ¥çœ‹[jni-rs](https://github.com/jni-rs/jni-rs/blob/master/example/mylib/src/lib.rs)ã€‚

å¾—ç›Šäº Rust çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä¸€äº›å†…å­˜æ¸…ç†æ“ä½œ Rust å·²ç»å¤„ç†äº†ï¼Œä¸éœ€è¦æˆ‘ä»¬å†æ‰‹åŠ¨çš„å¤„ç†ã€‚

```rust
impl<'a: 'b, 'b> Drop for JavaStr<'a, 'b> {
    fn drop(&mut self) {
        match self.env.release_string_utf_chars(self.obj, self.internal) {
            Ok(()) => {}
            Err(e) => warn!("error dropping java str: {}", e),
        }
    }
}
```

#### android åŠ¨æ€åº“å¤§å°

å› ä¸ºç”¨æˆ·å¯¹ RAMï¼Œæµé‡çš„å…³å¿ƒå’Œ Android ç‰ˆæœ¬å‘å‰å…¼å®¹åŸå› ï¼Œandroid å¼€å‘ä¸­å¯¹åŒ…ä½“ç§¯å¤§å°æ˜¯æ•æ„Ÿçš„ã€‚
å¯¹äº Rust ç¼–è¯‘äº§ç‰©ä½“ç§¯è¾ƒå¤§çš„é—®é¢˜ï¼Œåœ¨æŸ¥é˜…äº†[Minimizing Rust Binary Size](https://github.com/johnthagen/min-sized-rust)æ–‡ç« åï¼Œåœ¨ release æ¨¡å¼å¼€å¯ä¼˜åŒ–ã€‚

æˆ‘ä»¬å°† XLogï¼ŒLogan éƒ½åŠ å…¥åˆ° Demo çš„ä¾èµ–ä¸­ï¼Œå¯¹æ¯” release apk ä¸­çš„ 64 ä½åŠ¨æ€åº“å¤§å°ï¼Œå¦‚å›¾æ‰€ç¤º
![android so size](./android_so_size.png)

|         | EZLog(0.1.2) | EZLog(with backtrace) | XLog(1.2.5) | XLog(with libc++) | Logan(1.2.4) |
| :------ | :----------: | :-------------------: | :---------: | :---------------: | :----------: |
| so å¤§å° |   370.6KB    |        451.6KB        |   277.1KB   |       537KB       |    27.5KB    |

Rust ç¼–è¯‘çš„åŠ¨æ€åº“å¤§å°æ˜¯æœ€å¤§çš„ï¼Œä¸è¿‡ä¹Ÿæ²¡æœ‰å¤ªè¿‡äºå¤¸å¼ ï¼Œéšç€æ‰‹æœºç¡¬ä»¶çš„è¿›ä¸€æ­¥æå‡ï¼Œåº”è¯¥ä¸ä¼šæ˜¯åˆ¶çº¦ Rust åœ¨ android ä¸­åº”ç”¨çš„åŸå› ã€‚

#### å´©æºƒï¼Ÿ

ä¸åŒçš„æƒ…å†µä¸‹ï¼Œéœ€è¦ä¸åŒçš„æ–¹å¼

- åœ¨å¼€å‘ï¼Œæµ‹è¯•é˜¶æ®µï¼Œç”±äºç¼–å†™é”™è¯¯æˆ–è€…ä»£ç æ··æ·†ç­‰é—®é¢˜ï¼Œå¯¼è‡´ç±»ï¼Œæ–¹æ³•æ— æ³•æ‰¾åˆ°çš„æƒ…å†µï¼Œæˆ‘ä»¬å¸Œæœ›ç¨‹åºèƒ½ç›´æ¥å´©æºƒï¼Œå°½æ—©çš„æš´éœ²é—®é¢˜ã€‚
- äº§å“ä¸Šçº¿åï¼Œå› ä¸ºé€‚é…é—®é¢˜æˆ–è€…ç”¨æˆ·æ“ä½œå¯¼è‡´ bug å‡ºç°ï¼Œå¯¼è‡´æŸä¸ªæ¨¡å—çš„ä¸å¯ç”¨ã€‚æˆ‘ä»¬å¸Œæœ›é”™è¯¯åªé™å®šåœ¨è¿™ä¸ªæ¨¡å—ï¼Œä¸å½±å“å…¶ä»–çš„åŠŸèƒ½ï¼Œå¹¶ä¸ŠæŠ¥è¿™ä¸ªé”™è¯¯

Rust çš„é”™è¯¯åˆ†ä¸ºå¯æ¢å¤å’Œä¸å¯æ¢å¤çš„é”™è¯¯ã€‚Rust åˆå§‹åŒ–çº¿ç¨‹çš„ panic ä¼šå¯¼è‡´è¿›ç¨‹çš„é€€å‡ºã€‚ä¸€äº›è§£å†³æ–¹æ³•:

1. åªåœ¨éœ€è¦å´©æºƒæ—¶ä½¿ç”¨ panic å®
2. åœ¨ Clippy ä¸­åŠ å…¥ä½¿ç”¨ unwrap å’Œ except çš„è­¦å‘Š
3. æ›¿æ¢ [start..end] ä¸º get(start..end)
4. FFI ä¸­ catch_unwind

å³ä½¿è‡ªå·±çš„ä»£ç ä¸­æ²¡æœ‰ panic è°ƒç”¨ï¼Œä¾èµ–åº“ä¸­ä¹Ÿå¯èƒ½ä¼šè°ƒç”¨ã€‚æ‰€ä»¥éœ€è¦æä¾›åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å´©æºƒæ’æŸ¥çš„èƒ½åŠ›ã€‚

#### å´©æºƒæ’æŸ¥

åˆå§‹åŒ–æ—¶è®¾ç½® panic hookã€‚

```rust
#[cfg(not(feature = "backtrace"))]
fn hook_panic() {
    std::panic::set_hook(Box::new(|p| {
        event!(panic & format!("ezlog: \n {p:?}"));
    }));
}
```

åœ¨å´©æºƒæ—¶ä¼šå›è°ƒæ‹¿åˆ° PanicInfo

```
PanicInfo { payload: Any { .. }, message: Some(asdf), location: Location { file: "ezlog-core/src/lib.rs", line: 119, col: 5 },
```

PanicInfo ä¸­æœ‰é”™è¯¯ä¿¡æ¯ï¼Œpanic çš„æ–‡ä»¶è·¯å¾„å’Œä»£ç ä½ç½®ã€‚è¿™æ ·èƒ½ç²—ç•¥çš„æ’æŸ¥ bugã€‚
å¦‚æœæƒ³æ‹¿åˆ°å…·ä½“çš„å †æ ˆä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¾èµ– backtraceï¼Œè¿™æ ·æœ€ååŠ¨æ€åº“çš„å¤§å°ä¼šå¢åŠ  80KB å·¦å³

```rust
#[cfg(feature = "backtrace")]
fn hook_panic() {
    std::panic::set_hook(Box::new(|p| {
        let bt = Backtrace::new();
        event!(panic & format!("ezlog: \n {p:?} \n{bt:?} \n"));
    }));
}
```

<details>
<summary><b>æ·»åŠ  backtrace ä¾èµ–åï¼ŒiOS çš„å´©æºƒå †æ ˆæ‰“å°å¦‚ä¸‹</b></summary>
</p>

```plaintext
 PanicInfo { payload: Any { .. }, message: Some(asdf), location: Location { file: "ezlog-core/src/lib.rs", line: 119, col: 5 }, can_unwind: true }
   0: backtrace::backtrace::trace_unsynchronized
   1: backtrace::backtrace::trace
   2: backtrace::capture::Backtrace::create
   3: backtrace::capture::Backtrace::new
   4: ezlog::init::{{closure}}
   5: std::panicking::rust_panic_with_hook
   6: std::panicking::begin_panic_handler::{{closure}}
   7: std::sys_common::backtrace::__rust_end_short_backtrace
   8: _rust_begin_unwind
   9: core::panicking::panic_fmt
  10: ezlog::init
  11: _ezlog_init
  12: _$s5EZLog18ezlogInitWithTraceyyF
  13: _$s4demo7DemoAppVACycfC
  14: _$s4demo7DemoAppV7SwiftUI0C0AadEPxycfCTW
  15: <unknown>
  16: _$s4demo7DemoAppV5$mainyyFZ
  17: _main

```

</details>

<details>
<summary><b>android logcat è¾“å‡ºçš„å †æ ˆä¿¡æ¯ã€‚</b></summary>
</p>

```plaintext
PanicInfo { payload: Any { .. }, message: Some(asdf), location: Location { file: "ezlog-core/src/lib.rs", line: 119, col: 5 }, can_unwind: true }
  0: <unknown>
  1: <unknown>
  2: <unknown>
  3: <unknown>
  4: <unknown>
  5: <unknown>
  6: <unknown>
  7: Java_wtf_s1_ezlog_EZLog_init
  8: art_quick_generic_jni_trampoline
  9: art_quick_invoke_static_stub
10: _ZN3art11interpreter34ArtInterpreterToCompiledCodeBridgeEPNS_6ThreadEPNS_9ArtMethodEPNS_11ShadowFrameEtPNS_6JValueE
11: _ZN3art11interpreter6DoCallILb0ELb0EEEbPNS_9ArtMethodEPNS_6ThreadERNS_11ShadowFrameEPKNS_11InstructionEtPNS_6JValueE
12: MterpInvokeStatic
13: mterp_op_invoke_static
14: _ZN3art11interpreterL7ExecuteEPNS_6ThreadERKNS_20CodeItemDataAccessorERNS_11ShadowFrameENS_6JValueEbb.llvm.3351068054637636664
15: _ZN3art11interpreter33ArtInterpreterToInterpreterBridgeEPNS_6ThreadERKNS_20CodeItemDataAccessorEPNS_11ShadowFrameEPNS_6JValueE
16: _ZN3art11interpreter6DoCallILb0ELb0EEEbPNS_9ArtMethodEPNS_6ThreadERNS_11ShadowFrameEPKNS_11InstructionEtPNS_6JValueE
17: MterpInvokeStatic
18: mterp_op_invoke_static
19: _ZN3art11interpreterL7ExecuteEPNS_6ThreadERKNS_20CodeItemDataAccessorERNS_11ShadowFrameENS_6JValueEbb.llvm.3351068054637636664
20: _ZN3art11interpreter33ArtInterpreterToInterpreterBridgeEPNS_6ThreadERKNS_20CodeItemDataAccessorEPNS_11ShadowFrameEPNS_6JValueE
```

</details>

<details>
<summary><b>systemserver è¾“å‡ºçš„å´©æºƒæ—¥å¿—å¦‚ä¸‹</b></summary>
</p>

```
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: Build fingerprint: 'google/flame/flame:12/SP2A.220305.012/8177914:user/release-keys'
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: Revision: 'MP1.0'
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: ABI: 'arm64'
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: Timestamp: 2022-07-07 15:25:50.559643355+0800
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: Process uptime: 0s
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: Cmdline: wtf.s1.ezlog.demo
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: pid: 14112, tid: 14112, name: f.s1.ezlog.demo  >>> wtf.s1.ezlog.demo <<<
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: uid: 10287
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: signal 6 (SIGABRT), code -1 (SI_QUEUE), fault addr --------
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:     x0  0000000000000000  x1  0000000000003720  x2  0000000000000006  x3  0000007fc9d51120
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:     x4  00000000ebad808a  x5  00000000ebad808a  x6  00000000ebad808a  x7  00000000ebad808b
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:     x8  00000000000000f0  x9  f7d7529acf61ddf5  x10 0000000000000000  x11 ffffff80fffffbdf
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:     x12 0000000000000001  x13 0000007fc9d50fe8  x14 0000000000000000  x15 0000000000000008
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:     x16 0000007b425b6050  x17 0000007b42592db0  x18 0000007b523fa000  x19 0000000000003720
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:     x20 0000000000003720  x21 00000000ffffffff  x22 0000000000000001  x23 0000000000000001
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:     x24 000000782576bad8  x25 00000078256bb708  x26 000000000000000b  x27 0000007b51553000
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:     x28 0000007fc9d514a0  x29 0000007fc9d511a0
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:     lr  0000007b42545aa0  sp  0000007fc9d51100  pc  0000007b42545acc  pst 0000000000000000
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG: backtrace:
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #00 pc 000000000004facc  /apex/com.android.runtime/lib64/bionic/libc.so (abort+164) (BuildId: cd7952cb40d1a2deca6420c2da7910be)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #01 pc 00000000000b3f1c  /data/app/~~eRgxj9PHRfJEC-cex2WWJw==/wtf.s1.ezlog.demo-ngUhJZd2NWtJpUNIWy5f_g==/lib/arm64/libezlog.so
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #02 pc 00000000000b22a8  /data/app/~~eRgxj9PHRfJEC-cex2WWJw==/wtf.s1.ezlog.demo-ngUhJZd2NWtJpUNIWy5f_g==/lib/arm64/libezlog.so
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #03 pc 00000000000b2164  /data/app/~~eRgxj9PHRfJEC-cex2WWJw==/wtf.s1.ezlog.demo-ngUhJZd2NWtJpUNIWy5f_g==/lib/arm64/libezlog.so
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #04 pc 00000000000b203c  /data/app/~~eRgxj9PHRfJEC-cex2WWJw==/wtf.s1.ezlog.demo-ngUhJZd2NWtJpUNIWy5f_g==/lib/arm64/libezlog.so
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #05 pc 00000000000b142c  /data/app/~~eRgxj9PHRfJEC-cex2WWJw==/wtf.s1.ezlog.demo-ngUhJZd2NWtJpUNIWy5f_g==/lib/arm64/libezlog.so
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #06 pc 00000000000b1e6c  /data/app/~~eRgxj9PHRfJEC-cex2WWJw==/wtf.s1.ezlog.demo-ngUhJZd2NWtJpUNIWy5f_g==/lib/arm64/libezlog.so
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #07 pc 00000000000c5ad0  /data/app/~~eRgxj9PHRfJEC-cex2WWJw==/wtf.s1.ezlog.demo-ngUhJZd2NWtJpUNIWy5f_g==/lib/arm64/libezlog.so
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #08 pc 000000000007550c  /data/app/~~eRgxj9PHRfJEC-cex2WWJw==/wtf.s1.ezlog.demo-ngUhJZd2NWtJpUNIWy5f_g==/lib/arm64/libezlog.so
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #09 pc 00000000000741ec  /data/app/~~eRgxj9PHRfJEC-cex2WWJw==/wtf.s1.ezlog.demo-ngUhJZd2NWtJpUNIWy5f_g==/lib/arm64/libezlog.so (Java_wtf_s1_ezlog_EZLog_init+28)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #10 pc 00000000002d4044  /apex/com.android.art/lib64/libart.so (art_quick_generic_jni_trampoline+148) (BuildId: 46df93bc978921840e5b428398c66a57)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #11 pc 00000000002ca9e8  /apex/com.android.art/lib64/libart.so (art_quick_invoke_static_stub+568) (BuildId: 46df93bc978921840e5b428398c66a57)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #12 pc 00000000002ee6b8  /apex/com.android.art/lib64/libart.so (art::interpreter::ArtInterpreterToCompiledCodeBridge(art::Thread*, art::ArtMethod*, art::ShadowFrame*, unsigned short, art::JValue*)+320) (BuildId: 46df93bc978921840e5b428398c66a57)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #13 pc 000000000040ade4  /apex/com.android.art/lib64/libart.so (bool art::interpreter::DoCall<false, false>(art::ArtMethod*, art::Thread*, art::ShadowFrame&, art::Instruction const*, unsigned short, art::JValue*)+820) (BuildId: 46df93bc978921840e5b428398c66a57)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #14 pc 000000000076d4b8  /apex/com.android.art/lib64/libart.so (MterpInvokeStatic+3812) (BuildId: 46df93bc978921840e5b428398c66a57)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #15 pc 00000000002c5014  /apex/com.android.art/lib64/libart.so (mterp_op_invoke_static+20) (BuildId: 46df93bc978921840e5b428398c66a57)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #16 pc 00000000000790a2  [anon:dalvik-classes.dex extracted in memory from /data/app/~~eRgxj9PHRfJEC-cex2WWJw==/wtf.s1.ezlog.demo-ngUhJZd2NWtJpUNIWy5f_g==/base.apk] (wtf.s1.ezlog.EZLog.initWith+10)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #17 pc 000000000027d840  /apex/com.android.art/lib64/libart.so (art::interpreter::Execute(art::Thread*, art::CodeItemDataAccessor const&, art::ShadowFrame&, art::JValue, bool, bool) (.llvm.3351068054637636664)+644) (BuildId: 46df93bc978921840e5b428398c66a57)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #18 pc 000000000035a9e4  /apex/com.android.art/lib64/libart.so (art::interpreter::ArtInterpreterToInterpreterBridge(art::Thread*, art::CodeItemDataAccessor const&, art::ShadowFrame*, art::JValue*)+148) (BuildId: 46df93bc978921840e5b428398c66a57)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #19 pc 000000000040b05c  /apex/com.android.art/lib64/libart.so (bool art::interpreter::DoCall<false, false>(art::ArtMethod*, art::Thread*, art::ShadowFrame&, art::Instruction const*, unsigned short, art::JValue*)+1452) (BuildId: 46df93bc978921840e5b428398c66a57)
2022-07-07 15:25:50.712 14141-14141/? A/DEBUG:       #20 pc 000000000076d4b8  /apex/com.android.art/lib64/libart.so (MterpInvokeStatic+3812) (BuildId: 46df93bc978921840e5b428398c66a57)
```

</details>

å¯ä»¥å‘ç°ï¼Œandroid çš„å †æ ˆè¾“å‡ºé‡Œå¹¶æ²¡æœ‰å®Œæ•´çš„ Rust è°ƒç”¨å †æ ˆï¼Œæˆ‘å°è¯•é€šè¿‡[add2line](https://github.com/rust-windowing/android-ndk-rs/issues/101)çš„æ–¹æ³•ï¼Œä½†æ²¡æœ‰æˆåŠŸã€‚

### ä½¿ç”¨ Rust çš„ä½“éªŒ

- å­¦ä¹ æ›²çº¿é™¡å³­

æˆ‘åœ¨è¯»å®Œ [Rust å®˜æ–¹æ–‡æ¡£](https://doc.rust-lang.org/book) åï¼Œåˆè·Ÿç€ [Rust ç¬¬ä¸€æ­¥](https://docs.microsoft.com/en-us/learn/paths/rust-first-steps/) æ•²äº†ä¸€éä»£ç ã€‚å‘ç°è¿™åªæ˜¯ä¸ªå¼€å§‹ï¼Œåœ¨çœ‹äº†ä¸€é[Rust Nomicon](https://doc.rust-lang.org/nomicon/) [Rust Nomicon ä¸­æ–‡](https://nomicon.purewhite.io)å’Œ[Async Book](https://rust-lang.github.io/async-book)ä¹‹åï¼Œå°±å·²ç»æƒ³æ”¾å¼ƒäº†ã€‚å¤ªå¤šæ™¦æ¶©çš„å†…å®¹äº†ï¼Œæ¯”å¦‚ï¼š`Unsafe`, `PhantomData`,`Send and Sync`, `Pin`...

<img width = "200" src="./my_tail.gif"/>

ç›´æ¥ä¸€è¾¹å†™é¡¹ç›®ä¸€è¾¹å­¦å§ã€‚</br>

åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œå¼€æºç¤¾åŒºæä¾›çš„è§£å†³æ–¹æ¡ˆæœ‰æ—¶ä¼šæ›´åˆé€‚ã€‚æ¯”å¦‚ï¼š`crossbeam_channel`, `tokio`, `once_cell`, `thiserror`ç­‰ç­‰ï¼Œåœ¨ crates.io ä¸Šçœ‹å¼€æºé¡¹ç›®æ–‡æ¡£ä¹Ÿæ˜¯å­¦ä¹ çš„ä¸€éƒ¨åˆ†ã€‚

- æ–‡æ¡£

Rust å¤§éƒ¨åˆ†åº“çš„æ–‡æ¡£ï¼Œå¯¹è¯»è€…å¾ˆå‹å¥½ã€‚è¯¦å°½çš„æè¿°ï¼Œå®Œæ•´çš„ç¤ºä¾‹ã€‚å’Œ Java çš„ concurrent åŒ…çš„æ–‡æ¡£è¯»ç€ä¸€æ ·èˆ’æœã€‚çœ‹è¿™æ ·çš„æ–‡æ¡£ï¼Œå¥½åƒå°±ååœ¨ä½œè€…çš„å¤§è„‘çš®å±‚ä¸Šçœ‹ä»–å†™ä»£ç ã€‚
åè§‚ iOS å’Œ Andriod çš„ä¸€äº›æ–‡æ¡£ï¼Œå­—é‡Œè¡Œé—´ä»¿ä½›å†™ç€â€œä½ çŒœçŒœçœ‹è¿™ä¸ªæ€ä¹ˆç”¨â€ã€‚

<img width = "200" src="./yi.gif"/>

- å•å…ƒæµ‹è¯•

æ˜“ç”¨çš„å•å…ƒæµ‹è¯•ï¼Œéšæ—¶æ·»åŠ `#[test]`å°±å¯ä»¥å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚å¯¹æ¯”åœ¨ android é¡¹ç›®å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘è¿˜è¦å…ˆå»æœç´¢ï¼Œæœ‰å“ªäº›ä¾èµ–æ˜¯éœ€è¦æ·»åŠ çš„ã€‚
ç”¨ Rust åšå¼€å‘ï¼Œå’Œç³»ç»Ÿ API æ— å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨æ¡Œé¢ç¯å¢ƒå®Œæˆå¹¶æµ‹è¯•ï¼Œæœ€ååˆ°å¯¹åº”çš„å®¢æˆ·ç«¯éªŒè¯ã€‚æ•ˆç‡æ¯”èµ·æ‰€æœ‰é€»è¾‘éƒ½åœ¨æ‰‹æœºä¸ŠéªŒè¯é«˜å¤šäº†ã€‚

- é”™è¯¯å¤„ç†

Rust å¯æ¢å¤é”™è¯¯å¼ºåˆ¶å¤„ç†ï¼Œå½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ° Result é‚£å·¨é•¿çš„æ–¹æ³•åˆ—è¡¨ï¼Œå°±åƒçœ‹åˆ°å¤§é—¸èŸ¹èº«ä¸Šä¸€åœˆä¸€åœˆçš„ç»³å­ï¼Œè¦ä¸ä¸€å‰ªåˆ€(unwrap)äº†äº‹ï¼Ÿæˆ‘ä»¬ä¸æƒ³åœ¨åº“é‡Œç›´æ¥ panicï¼Œå°±åªèƒ½çœ‹æ–‡æ¡£äº†ã€‚é¿å…å›¾ç‰‡è¿‡é•¿ï¼Œç”¨äº† 3 å¼ å›¾æ˜¾ç¤º:

<p align="center">
    <img src="./result_1.png" width="31%"/>
    &nbsp;
    <img src="./result_2.png" width="30%"/>
    &nbsp;
    <img src="./result_3.png" width="32%"/>
</p>

ä¹ æƒ¯äº† try catch çš„é”™è¯¯å¤„ç†æ–¹å¼ï¼Œåˆšå¼€å§‹å¤„ç† Result/Option æ˜¯æ‡µçš„ã€‚é€šè¿‡æ–‡æ¡£ç¤ºä¾‹å’Œ Clippy æç¤ºï¼ŒèŠ±ä¸€äº›æ—¶é—´å°±èƒ½æŒæ¡ã€‚å½“æˆ‘å¼€å§‹ç†Ÿæ‚‰è¿™æ ·çš„é”™è¯¯å¤„ç†æ–¹å¼ï¼Œæˆ‘ä¸æ—¶ä¼šæ€€ç–‘ï¼Œä¹‹å‰æ˜¯æ€ä¹ˆåœ¨ Java/Kotlin ä¸­åªç”¨ try catch å°±èƒ½å†™å®Œé‚£äº›ä»£ç çš„ã€‚ã€‚ã€‚

- ç”Ÿå‘½å‘¨æœŸå’Œæ‰€æœ‰æƒ

Rust ç¼–è¯‘å™¨çš„æ‰€æœ‰æƒ/ç”Ÿå‘½å‘¨æœŸæ£€æŸ¥ï¼Œå¿…é¡»åœ¨ç¼–ç çš„æ—¶å€™å°±è€ƒè™‘å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå†…å­˜çš„åˆ†é…é—®é¢˜ã€‚å¯¹æ¯” C/C++ å°†ç¼–ç çš„ç—›è‹¦å‰ç½®äº†ã€‚å¯¹æ¯”æœ‰ GC çš„è¯­éŸ³ï¼Œå¿ƒæ™ºæˆæœ¬å¤§å¹…æé«˜ã€‚

- ç¼–è¯‘æ—¶é—´

debug æ¨¡å¼ä¸‹

```
cargo clean && cargo build -p ezlog
Finished dev [unoptimized + debuginfo] target(s) in 14.19s
```

ä½¿ç”¨ç¼“å­˜ï¼Œæ›´æ”¹ä¸€è¡Œä»£ç ï¼Œå†æ¬¡ç¼–è¯‘

```
cargo build -p ezlog
Finished dev [unoptimized + debuginfo] target(s) in 1.46s
```

æ— ç¼“å­˜ release æ¨¡å¼ä¸‹

```
target `aarch64-apple-ios`
Finished release [optimized] target(s) in 45.43s

target `aarch64-apple-ios-sim`
Finished release [optimized] target(s) in 40.83s

target `x86_64-apple-ios`
Finished release [optimized] target(s) in 39.26s

Building armeabi-v7a (armv7-linux-androideabi)
Finished release [optimized] target(s) in 47.64s

Building arm64-v8a (aarch64-linux-android)
Finished release [optimized] target(s) in 50.71s
```

åœ¨å°å‹é¡¹ç›®ä½¿ç”¨ Rustï¼ŒåŸºæœ¬æ²¡æœ‰ç¼–è¯‘æ‘¸é±¼æ—¶é—´ã€‚å¯¹äºç§»åŠ¨ç«¯å¼€å‘æ¥è¯´ï¼Œæœ‰è¿‡æ— ç¼–è¯‘ä¼˜åŒ–çš„ä¸­å‹é¡¹ç›®çš„ Gradle æˆ–è€… XCode æ„å»ºä½“éªŒï¼Œè¿™ç‚¹ç¼–è¯‘æ—¶é—´éƒ½ä¸ç®—äº‹ã€‚</br>
å¦‚æœæƒ³è¦åŠ é€Ÿ Android ç«¯éªŒè¯çš„æ•ˆç‡ï¼Œé‚£ä¹ˆæœ€å¥½å•ç‹¬æ–°å¢ crateï¼Œç”¨[android-ndk-rs](https://github.com/rust-windowing/android-ndk-rs)è¿™æ ·çš„å·¥å…·ï¼ŒåŠ¨æ€è·å– targetï¼Œå› ä¸ºæ²¡æœ‰ Java/Kotlin ä»£ç ï¼Œè·³è¿‡ gradle çš„æ„å»ºç›´æ¥ç”Ÿæˆ APK éƒ¨ç½²ã€‚

### æ€»ç»“

#### å­¦ä¹ æˆæœ¬

å¯¹äºæ–°æ‰‹ï¼ŒRust æ–‡æ¡£å‹å¥½ï¼Œç¤¾åŒºæ´»è·ƒã€‚è¿˜æœ‰å®˜æ–¹æ”¯æŒçš„çš„åŒ…ç®¡ç†å·¥å…· Cargoï¼Œä»£ç æ£€æŸ¥å·¥å…· Clippyã€‚ä¸ªäººè®¤ä¸ºä¸Šæ‰‹éš¾åº¦è¦ä½äº C++ã€‚

#### å¼€å‘æ•ˆç‡

Rust çš„å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œç¼–è¯‘å™¨å¯¹å€Ÿç”¨ï¼Œç”Ÿå‘½å‘¨æœŸçš„æ£€æŸ¥ã€‚å¯¼è‡´æ–°æ‰‹åœ¨åˆæœŸå¼€å‘æ•ˆç‡ä½ä¸‹ã€‚éšç€å¯¹è¯­è¨€ç†Ÿæ‚‰ç¨‹åº¦çš„æé«˜ï¼Œä»¥åŠæ˜“ç”¨çš„æµ‹è¯•æ¡†æ¶ï¼Œæ–¹ä¾¿çš„è·¨å¹³å°ç¼–è¯‘ï¼Œå¯ä»¥å¼¥è¡¥å‰æœŸçš„å¼€å‘æ•ˆç‡åŠ£åŠ¿ï¼ŒåŠ ä¸Š Rust å†…å­˜å®‰å…¨çš„ç‰¹ç‚¹ï¼Œä¹Ÿé™ä½äº†åæœŸé¡¹ç›®ç»´æŠ¤çš„éš¾åº¦ã€‚</p>

#### é€‚ç”¨

ä» 0 å¼€å§‹æ„å»ºä¸€ä¸ªæ–°çš„è·¨å¹³å° Appï¼Œæ‰€æœ‰çš„é UI é€»è¾‘ï¼Œéƒ½ä½¿ç”¨ Rust å®ç°ï¼Œæ„å»ºæˆå•ä¸€çš„é™æ€/åŠ¨æ€åº“ï¼Œæä¾› FFI æ”¯æŒã€‚
Flutter/RN/Compose/SwiftUI ç­‰ç­‰çš„æ¡†æ¶åš UI äº¤äº’ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨ Rust å¾ˆåˆé€‚ã€‚

ä½†æ˜¯å¦‚æœæƒ³åœ¨ç°æœ‰çš„ App ä¸­å¤§é‡ä½¿ç”¨ Rustï¼Œé‚£ä¹ˆäºŒè¿›åˆ¶ä¾èµ–æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ‰å¤šä¸ªä¸šåŠ¡ crateï¼Œæ‰“åŒ…æˆå¤šä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚é‚£ä¹ˆå„ä¸ª Rust çš„äº§ç‰©å¯èƒ½ä¼šåŒ…å«ç›¸åŒçš„ä¾èµ–ï¼Œæ¯”å¦‚ libc, syn, cfg-if, memchrç­‰ç­‰ã€‚æœ€åçš„åŒ…å¤§å°ä¼šéšç€ä¸šåŠ¡çš„å¢å¤šå¿«é€Ÿè†¨èƒ€ã€‚

#### åç»­

é¡¹ç›®éœ€è¦ç»§ç»­å®Œå–„çš„åœ°æ–¹

- [ ] Unsafe ä»£ç å®¡æŸ¥
- [ ] æä¾›è¯¦ç»†äº‹ä»¶ç›‘æ§å›è°ƒ
- [ ] æ–‡æ¡£å®Œå–„
- [ ] ç¤ºä¾‹å®Œå–„
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] GUI æ”¯æŒ

é™¤äº†å®ç°äº† androidï¼ŒiOS çš„è·¨å¹³å°ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä½¿ç”¨åœºæ™¯ã€‚

- [x] å…¼å®¹ Windowsï¼Œæ»¡è¶³æ¡Œé¢ç«¯çš„éœ€æ±‚ã€‚
- [x] æä¾› Flutter MethodChannel SDKã€‚
- [ ] æä¾› Flutter FFI SDKã€‚
- [ ] ç»™å…¶ä»–çš„åº“ï¼Œæ¸¸æˆæ¡†æ¶æä¾› log æ’ä»¶ï¼Œæ¯”å¦‚ï¼š[Bevy](https://github.com/bevyengine/bevy)ï¼Œ[Tauri](https://github.com/tauri-apps/tauri)ã€‚

#### Tips

- æ·»åŠ  configï¼Œå¿«é€Ÿåˆ‡æ¢ target

åœ¨é¡¹ç›®ä¸­æ·»åŠ  ./.cargo/configï¼Œå¹¶é…ç½®

```
[build]
target = "aarch64-linux-android"
...
```

æ³¨é‡Šæ‰å…¶ä»–çš„ target åï¼Œåœ¨ vscode ä¸­åŒå‡» shift è¾“å…¥ >> æ‰¾åˆ° reload workspaceï¼Œå°±å¯ä»¥åˆ‡æ¢åˆ°å¯¹åº”çš„ target äº†ã€‚

- ä½¿ç”¨ thiserror åº“æ¥å¤„ç†è‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹ï¼Œå¯ä»¥çœæ‰å¾ˆå¤šæ¨¡ç‰ˆä»£ç ã€‚

#### å‚è€ƒæ–‡ç« åŠå¼€æºé¡¹ç›®

- [mozilla multi platform arch design](https://mozilla.github.io/uniffi-rs/#design)
- [Android Rust crates](https://android.googlesource.com/platform/external/rust/crates)
- [Android Rust Introduction](https://source.android.com/setup/build/rust/building-rust-modules/overview?hl=en)
- [Flutter Rust Bridge](https://github.com/fzyzcjy/flutter_rust_bridge)

**FFI**

- [rust ffi doc](https://doc.rust-lang.org/nomicon/ffi.html)
- [how to call rust functions from c on linux h37](https://dev.to/dandyvica/how-to-call-rust-functions-from-c-on-linux-h37)
- [how does rust ffi pass parameters of type vec u8](https://users.rust-lang.org/t/how-does-rust-ffi-pass-parameters-of-type-vec-u8/55118)
- [How to return byte array from rust to c](https://users.rust-lang.org/t/how-to-return-byte-array-from-rust-function-to-ffi-c/18136)

**android**

- [Rust bindings to the JNI](https://docs.rs/jni/latest/jni/)
- [JNI crate exapmles](https://github.com/jni-rs/jni-rs/blob/master/example/mylib/src/lib.rs)
- [Implementing JNI_OnLoad](https://github.com/jni-rs/jni-rs/issues/257)
- [Rust on Android](https://mozilla.github.io/firefox-browser-architecture/experiments/2017-09-21-rust-on-android.html)
- [cargo ndk](https://github.com/bbqsrc/cargo-ndk)
- [Minimizing Rust Binary Size](https://github.com/johnthagen/min-sized-rust)
- [Rust ä¸­çš„ bin, lib, rlib, a, so æ¦‚å¿µä»‹ç»](https://rustcc.cn/article?id=98b96e69-7a5f-4bba-a38e-35bdd7a0a7dd)

**iOS**

- [Create your own CocoaPods library](https://medium.com/@jeantimex/create-your-own-cocoapods-library-da589d5cd270)
- [Building and Deploying a Rust library on iOS via Mozilla](https://mozilla.github.io/firefox-browser-architecture/experiments/2017-09-06-rust-on-ios.html)
- [Rust on iOS and Mac Catalyst](https://nadim.computer/posts/2022-02-11-maccatalyst.html)
- [recipe swift rust callback](https://www.nickwilcox.com/blog/recipe_swift_rust_callback/)

**å…¶ä»–**

- [Backtrace Capture on mobile in production enviroment](https://users.rust-lang.org/t/anybody-using-backtrace-capture-stack-trace-in-android-ios-should-backtrace-be-used-in-production-environments-mobile-phones-seems-that-iphone-with-arm-does-not-support-backtrace-at-all/65856)
- [Cannot get backtrace on Android](https://github.com/rust-lang/backtrace-rs/issues/442)
- [Gimli doesn't support iOS](https://github.com/rust-lang/backtrace-rs/issues/350)
- [Transform backtrace to string during catch unwind](https://stackoverflow.com/questions/68556819/transform-backtrace-to-string-during-catch-unwind)
- [Android backtraces don't work since gimli is used as the symbolizer](https://github.com/rust-windowing/android-ndk-rs/issues/101)
